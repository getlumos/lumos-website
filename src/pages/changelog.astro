---
import Layout from '../layouts/Layout.astro';
import NavbarAstro from '../components/NavbarAstro.astro';
import FooterAstro from '../components/FooterAstro.astro';

interface ChangeItem {
  text: string;
  subItems?: string[];
}

interface ChangeSection {
  type: "added" | "changed" | "fixed" | "security" | "breaking" | "dependencies" | "testing" | "documentation";
  items: ChangeItem[];
}

interface Release {
  version: string;
  date: string;
  title?: string;
  description?: string;
  sections: ChangeSection[];
  compareUrl?: string;
  releaseUrl: string;
}

const releases: Release[] = [
  {
    version: "0.3.0",
    date: "2025-12-10",
    title: "Docker Distribution & Deployment",
    description: "Major release with Docker containerization, CI/CD improvements, and deployment infrastructure.",
    sections: [
      {
        type: "added",
        items: [
          {
            text: "Docker Distribution Support",
            subItems: [
              "Multi-stage Dockerfile for optimized production builds",
              "Docker Compose for easy deployment",
              "GitHub Actions for automated Docker image builds",
              "Published to GitHub Container Registry (ghcr.io)",
            ],
          },
          {
            text: "Download Metrics",
            subItems: [
              "Shields.io badges for crates.io downloads",
              "Real-time download tracking",
            ],
          },
        ],
      },
      {
        type: "fixed",
        items: [
          { text: "Criterion black_box deprecation warning" },
          { text: "Tech debt cleanup (#145, #148)" },
        ],
      },
    ],
    compareUrl: "https://github.com/getlumos/lumos/compare/v0.2.0...v0.3.0",
    releaseUrl: "https://github.com/getlumos/lumos/releases/tag/v0.3.0",
  },
  {
    version: "0.2.0",
    date: "2025-11-24",
    title: "Multi-File Imports & Type Aliases",
    description: "Major feature release introducing modular schema architecture with imports and type aliases.",
    sections: [
      {
        type: "added",
        items: [
          {
            text: "Type Aliases (#52)",
            subItems: [
              "Rust-style type alias syntax: `type UserId = PublicKey;`",
              "Recursive type resolution with circular reference detection",
              "Generate Rust `pub type` and TypeScript `export type` aliases",
            ],
          },
          {
            text: "Multi-File Imports (#52)",
            subItems: [
              "JavaScript-style import syntax: `import { Type1, Type2 } from \"./file.lumos\";`",
              "Automatic import discovery and resolution",
              "Circular import detection with clear error messages",
            ],
          },
          {
            text: "New File Resolver",
            subItems: [
              "`FileResolver` module (340 lines) for multi-file schema management",
              "Import caching to avoid duplicate parsing",
            ],
          },
          {
            text: "Examples",
            subItems: [
              "`examples/type_aliases.lumos` - 200+ lines, 23 types",
              "`examples/imports/` - Multi-file import examples with 7 files",
            ],
          },
        ],
      },
      {
        type: "changed",
        items: [
          { text: "Updated AST to include `Import` and `TypeAlias` structs" },
          { text: "Extended IR with `TypeAliasDefinition` and `TypeAlias` variant" },
          { text: "CLI `generate` command now uses `FileResolver` for multi-file support" },
          { text: "All generators updated to handle type aliases" },
        ],
      },
      {
        type: "fixed",
        items: [
          { text: "15+ non-exhaustive pattern matches across codebase" },
          { text: "Enum import validation timing (deferred until all files loaded)" },
          { text: "Multi-line import parsing with regex support" },
        ],
      },
      {
        type: "dependencies",
        items: [
          { text: "Added `regex = \"1.10\"` for import parsing" },
        ],
      },
      {
        type: "testing",
        items: [
          { text: "Added 4 new file_resolver tests" },
          { text: "All 202 tests passing (100% success rate)" },
        ],
      },
    ],
    compareUrl: "https://github.com/getlumos/lumos/compare/v0.1.1...v0.2.0",
    releaseUrl: "https://github.com/getlumos/lumos/releases/tag/v0.2.0",
  },
  {
    version: "0.1.1",
    date: "2025-11-23",
    title: "LSP & Schema Evolution",
    description: "Feature release with Language Server Protocol support, schema versioning, and security improvements.",
    sections: [
      {
        type: "added",
        items: [
          { text: "Schema versioning with `#[version]` attribute" },
          { text: "Automatic migration code generation" },
          { text: "Backward compatibility validation" },
          { text: "Deprecation warnings for schema fields" },
          { text: "Schema diff tool: `lumos diff`" },
          { text: "Language Server Protocol (LSP) implementation" },
          { text: "Custom derive macros support" },
          { text: "Fixed-size arrays with const generics" },
        ],
      },
      {
        type: "security",
        items: [
          { text: "User-defined type validation during transformation" },
          { text: "Path traversal protection in CLI" },
          { text: "u64 precision warnings in TypeScript output" },
        ],
      },
      {
        type: "changed",
        items: [
          { text: "Enhanced error messages with source location tracking" },
          { text: "Expanded test suite to 202 tests (from 64)" },
        ],
      },
    ],
    compareUrl: "https://github.com/getlumos/lumos/compare/v0.1.0...v0.1.1",
    releaseUrl: "https://github.com/getlumos/lumos/releases/tag/v0.1.1",
  },
  {
    version: "0.1.0",
    date: "2025-11-01",
    title: "Initial Release",
    description: "First stable release of LUMOS - Type-safe schema language for Solana development.",
    sections: [
      {
        type: "added",
        items: [
          { text: "Core schema language with structs and enums" },
          { text: "Rust and TypeScript code generation" },
          { text: "Borsh serialization support" },
          { text: "Anchor framework integration" },
          { text: "Context-aware code generation" },
          { text: "CLI tool with multiple commands" },
          { text: "VSCode extension" },
          { text: "Comprehensive documentation" },
        ],
      },
    ],
    releaseUrl: "https://github.com/getlumos/lumos/releases/tag/v0.1.0",
  },
];

const sectionConfig: Record<string, { label: string; color: string; bg: string; iconPath: string }> = {
  added: { label: "Added", color: "text-green-400", bg: "bg-green-500/10", iconPath: "M12 4v16m8-8H4" },
  changed: { label: "Changed", color: "text-blue-400", bg: "bg-blue-500/10", iconPath: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" },
  fixed: { label: "Fixed", color: "text-yellow-400", bg: "bg-yellow-500/10", iconPath: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" },
  security: { label: "Security", color: "text-purple-400", bg: "bg-purple-500/10", iconPath: "M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" },
  breaking: { label: "Breaking Changes", color: "text-red-400", bg: "bg-red-500/10", iconPath: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" },
  dependencies: { label: "Dependencies", color: "text-cyan-400", bg: "bg-cyan-500/10", iconPath: "M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" },
  testing: { label: "Testing", color: "text-orange-400", bg: "bg-orange-500/10", iconPath: "M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" },
  documentation: { label: "Documentation", color: "text-pink-400", bg: "bg-pink-500/10", iconPath: "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" },
};
---

<Layout
  title="Changelog - LUMOS"
  description="All notable changes to LUMOS. Track new features, improvements, and bug fixes across releases."
>
  <NavbarAstro slot="navbar" />

  <div class="pt-16">
    <!-- Hero Section -->
    <section class="pt-16 pb-16 px-4 sm:px-6 lg:px-8">
      <div class="container mx-auto max-w-4xl text-center">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-secondary/50 backdrop-blur-sm border border-border mb-6">
          <svg class="w-4 h-4 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
          </svg>
          <span class="text-sm text-muted-foreground">Keep a Changelog Format</span>
        </div>
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-6">
          <span class="bg-gradient-to-r from-purple-500 to-purple-400 bg-clip-text text-transparent">What's New</span> in LUMOS
        </h1>
        <p class="text-xl text-muted-foreground max-w-2xl mx-auto">
          All notable changes to LUMOS are documented here. We follow{" "}
          <a href="https://semver.org" class="text-primary hover:underline" target="_blank" rel="noopener noreferrer">
            Semantic Versioning
          </a>.
        </p>
      </div>
    </section>

    <!-- Timeline -->
    <section class="py-8 px-4 sm:px-6 lg:px-8">
      <div class="container mx-auto max-w-4xl">
        <div class="relative">
          <!-- Timeline line -->
          <div class="absolute left-8 top-0 bottom-0 w-px bg-border hidden md:block"></div>

          <div class="space-y-12">
            {releases.map((release, index) => (
              <div class="relative">
                <!-- Timeline dot -->
                <div class="absolute left-6 w-5 h-5 rounded-full bg-primary border-4 border-background hidden md:flex items-center justify-center">
                  <div class="w-2 h-2 rounded-full bg-primary-foreground"></div>
                </div>

                <!-- Release card -->
                <div class="md:ml-20 bg-secondary/30 rounded-xl border border-border overflow-hidden">
                  <!-- Header -->
                  <div class="p-6 border-b border-border">
                    <div class="flex flex-wrap items-center gap-3 mb-3">
                      <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-primary/20 text-primary font-mono font-bold">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                        </svg>
                        v{release.version}
                      </div>
                      <span class="text-sm text-muted-foreground">{release.date}</span>
                      {index === 0 && (
                        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-green-500/20 text-green-400 border border-green-500/30">
                          Latest
                        </span>
                      )}
                    </div>
                    {release.title && (
                      <h2 class="text-xl font-bold mb-2">{release.title}</h2>
                    )}
                    {release.description && (
                      <p class="text-muted-foreground">{release.description}</p>
                    )}
                  </div>

                  <!-- Sections -->
                  <div class="p-6 space-y-6">
                    {release.sections.map((section) => {
                      const config = sectionConfig[section.type];
                      return (
                        <div>
                          <div class={`inline-flex items-center gap-2 px-3 py-1 rounded-full ${config.bg} ${config.color} text-sm font-medium mb-3`}>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={config.iconPath} />
                            </svg>
                            {config.label}
                          </div>
                          <ul class="space-y-2 ml-1">
                            {section.items.map((item) => (
                              <li class="text-sm">
                                <div class="flex items-start gap-2">
                                  <span class="text-muted-foreground mt-1.5">•</span>
                                  <div>
                                    <span class="text-foreground">{item.text}</span>
                                    {item.subItems && (
                                      <ul class="mt-1 space-y-1 ml-4">
                                        {item.subItems.map((subItem) => (
                                          <li class="text-muted-foreground text-xs flex items-start gap-2">
                                            <span class="mt-1">◦</span>
                                            <span>{subItem}</span>
                                          </li>
                                        ))}
                                      </ul>
                                    )}
                                  </div>
                                </div>
                              </li>
                            ))}
                          </ul>
                        </div>
                      );
                    })}
                  </div>

                  <!-- Footer -->
                  <div class="px-6 py-4 bg-secondary/20 border-t border-border flex flex-wrap gap-3">
                    <a
                      href={release.releaseUrl}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="inline-flex items-center justify-center rounded-lg text-sm font-medium h-9 px-4 hover:bg-accent hover:text-accent-foreground transition-colors"
                    >
                      <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                      </svg>
                      Release Notes
                    </a>
                    {release.compareUrl && (
                      <a
                        href={release.compareUrl}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center justify-center rounded-lg text-sm font-medium h-9 px-4 hover:bg-accent hover:text-accent-foreground transition-colors"
                      >
                        View Changes
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                        </svg>
                      </a>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 px-4 sm:px-6 lg:px-8 bg-secondary/20">
      <div class="container mx-auto max-w-4xl text-center">
        <h2 class="text-3xl font-bold mb-4">Stay Updated</h2>
        <p class="text-muted-foreground mb-8 max-w-2xl mx-auto">
          Watch the repository on GitHub to get notified about new releases.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="https://github.com/getlumos/lumos"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center rounded-lg text-lg font-semibold h-14 px-8 bg-primary text-primary-foreground hover:bg-primary/90 transition-colors"
          >
            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            Star on GitHub
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>
          <a
            href="https://github.com/getlumos/lumos/subscription"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center justify-center rounded-lg text-lg font-semibold h-14 px-8 border border-input bg-background hover:bg-accent hover:text-accent-foreground transition-colors"
          >
            Watch Releases
          </a>
        </div>
      </div>
    </section>
  </div>

  <FooterAstro slot="footer" />
</Layout>
